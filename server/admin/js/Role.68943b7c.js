(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Role"],{"26bf":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",[e._v("角色列表")]),r("list-form",{attrs:{modelName:"roles",currentPage:e.currentPage,size:e.pageSize,selectionList:e.selectionList,removeMany:e.removeMany},on:{keywordChange:function(t){e.searchKeyword=t},searchData:e.handleSearchedData}}),r("el-table",{attrs:{data:e.items},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),r("el-table-column",{attrs:{prop:"_id",label:"ID"}}),r("el-table-column",{attrs:{prop:"name",label:"名称"}}),r("el-table-column",{attrs:{prop:"description",label:"描述"}}),r("el-table-column",{attrs:{fixed:"right",label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("ListOptionBtn",{attrs:{modelName:e.modelName,row:t.row,removeOne:e.remove}})]}}])})],1),r("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":10,background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.totalSize},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},n=[],i=r("8568"),s={name:"RoleList",mixins:[i["a"]]},c=s,o=r("2877"),l=Object(o["a"])(c,a,n,!1,null,null,null);t["default"]=l.exports},"4de4":function(e,t,r){"use strict";var a=r("23e7"),n=r("b727").filter,i=r("1dde"),s=i("filter");a({target:"Array",proto:!0,forced:!s},{filter:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},"4df4":function(e,t,r){"use strict";var a=r("da84"),n=r("0366"),i=r("c65b"),s=r("7b0b"),c=r("9bdd"),o=r("e95a"),l=r("68ee"),d=r("07fa"),u=r("8418"),h=r("9a1f"),f=r("35a1"),p=a.Array;e.exports=function(e){var t=s(e),r=l(this),a=arguments.length,m=a>1?arguments[1]:void 0,b=void 0!==m;b&&(m=n(m,a>2?arguments[2]:void 0));var g,y,v,k,w,x,_=f(t),C=0;if(!_||this==p&&o(_))for(g=d(t),y=r?new this(g):p(g);g>C;C++)x=b?m(t[C],C):t[C],u(y,C,x);else for(k=h(t,_),w=k.next,y=r?new this:[];!(v=i(w,k)).done;C++)x=b?c(k,m,[v.value,C],!0):v.value,u(y,C,x);return y.length=C,y}},"4fad":function(e,t,r){var a=r("23e7"),n=r("6f53").entries;a({target:"Object",stat:!0},{entries:function(e){return n(e)}})},"6f53":function(e,t,r){var a=r("83ab"),n=r("e330"),i=r("df75"),s=r("fc6a"),c=r("d1e7").f,o=n(c),l=n([].push),d=function(e){return function(t){var r,n=s(t),c=i(n),d=c.length,u=0,h=[];while(d>u)r=c[u++],a&&!o(n,r)||l(h,e?[r,n[r]]:n[r]);return h}};e.exports={entries:d(!0),values:d(!1)}},"9bdd":function(e,t,r){var a=r("825a"),n=r("2a62");e.exports=function(e,t,r,i){try{return i?t(a(r)[0],r[1]):t(r)}catch(s){n(e,"throw",s)}}},a630:function(e,t,r){var a=r("23e7"),n=r("4df4"),i=r("1c7e"),s=!i((function(e){Array.from(e)}));a({target:"Array",stat:!0,forced:s},{from:n})},d5a0:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"about"},[r("h1",[e._v(e._s(e.id?"编辑":"新建")+"角色")]),r("el-form",{ref:"RoleForm",attrs:{model:e.model,rules:e.rules,"label-width":"120px"},nativeOn:{submit:function(t){return t.preventDefault(),e.save.apply(null,arguments)}}},[r("el-form-item",{attrs:{label:"名称",prop:"name"}},[r("el-input",{model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1),r("el-form-item",{attrs:{label:"描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.model.description,callback:function(t){e.$set(e.model,"description",t)},expression:"model.description"}})],1),r("el-form-item",[r("el-tabs",{attrs:{type:"border-card"}},[r("el-tab-pane",{attrs:{label:"权限"}},[r("div",{staticClass:"d-flex",staticStyle:{padding:"0 20 px"}},[r("div",{staticClass:"flex-grow"},[r("h4",[e._v("前端界面权限：")]),r("el-tree",{ref:"webTree",staticClass:"right-tree",attrs:{data:e.adminWebTreeData,"show-checkbox":"","node-key":"id",indent:44,"expand-on-click-node":!1,"check-on-click-node":!0,"default-expand-all":!0,"default-expanded-keys":[],"default-checked-keys":e.defaultAdminWebCheckedKeys},on:{check:e.clickWebTree},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return["category"==a.type?r("span",{staticClass:"tree-item cate"},[r("el-tag",{attrs:{type:"info"}},[e._v(e._s(a.label))])],1):"right"==a.type?r("span",{staticClass:"tree-item"},[r("el-tag",{attrs:{type:e.methodType[a.right]}},[e._v(e._s(a.right))]),r("span",{staticStyle:{"margin-left":"5px"}},[e._v(e._s(a.desc))])],1):"page"==a.type?r("span",{staticClass:"tree-item"},[r("el-tag",{attrs:{type:"info"}},[e._v(e._s(a.label.replace("页面","")))]),r("span",{staticStyle:{color:"#606266","margin-left":"5px"}},[e._v("页面")])],1):"group"==a.type?r("span",{staticClass:"tree-item"},[r("el-tag",{staticClass:"group",attrs:{type:"info"}},[e._v(e._s(a.name))]),r("span",{staticStyle:{color:"#606266","margin-left":"5px"}},[e._v("分组")])],1):e._e()]}}])})],1),r("div",{staticClass:"flex-grow"},[r("h4",[e._v("API接口权限：")]),r("el-tree",{ref:"apiTree",staticClass:"right-tree",attrs:{data:e.apiRightTreeData,"show-checkbox":"","node-key":"id",indent:44,"expand-on-click-node":!1,"check-on-click-node":!0,"default-expand-all":!0,"default-expanded-keys":[],"default-checked-keys":e.defaultApiRightCheckedKeys},on:{check:e.clickApiTree},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return["category"==a.type?r("span",{staticClass:"tree-item cate"},[r("el-tag",{attrs:{type:"info"}},[e._v(e._s(a.name))])],1):"right"==a.type?r("span",{staticClass:"tree-item"},[r("el-tag",{staticClass:"method",attrs:{type:e.methodType[a.right]}},[e._v(e._s(a.right))]),r("span",{staticStyle:{"margin-left":"5px"}},[e._v(e._s(a.desc))])],1):r("span",{staticClass:"tree-item"},[r("el-tag",{attrs:{type:"info"}},[e._v(e._s(a.path))]),r("span",{staticStyle:{color:"#606266","margin-left":"5px"}},[e._v("接口")])],1)]}}])})],1)])])],1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary","native-type":"submit"}},[e._v("保存")])],1)],1)],1)},n=[];function i(e){if(Array.isArray(e))return e}r("a4d3"),r("e01a"),r("d3b7"),r("d28b"),r("3ca3"),r("ddb0");function s(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i=[],s=!0,c=!1;try{for(r=r.call(e);!(s=(a=r.next()).done);s=!0)if(i.push(a.value),t&&i.length===t)break}catch(o){c=!0,n=o}finally{try{s||null==r["return"]||r["return"]()}finally{if(c)throw n}}return i}}r("fb6a"),r("b0c0"),r("a630"),r("ac1f"),r("00b4");function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function o(e,t){if(e){if("string"===typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}r("d9e2");function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){return i(e)||s(e,t)||o(e,t)||l()}function u(e){if(Array.isArray(e))return c(e)}function h(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(e){return u(e)||h(e)||o(e)||f()}var m=r("c7eb"),b=r("1da1"),g=(r("d81d"),r("159b"),r("1276"),r("4de4"),r("4fad"),r("ca00")),y={name:"RoleEdit",props:{id:{}},computed:{apiRightTreeData:function(){var e=this,t=[],r={},a=this.apiRights.reduce((function(e,t){var a=t.category;return r[a._id]||(r[a._id]=!0,e.push(a)),e}),new Array);return t=a.map((function(t,r){return t.id=r+1,t.label=t.name,t.type="category",t.children=[],e.apiRights.forEach((function(e){if(e.category._id===t._id){e.id=e._id,e.label=e.path+" 接口",e.type="url",e.children=[];var r=e.description.split("、");e.methods.forEach((function(t,a){e.children.push({label:t+" "+r[a],id:t+"-"+e._id,type:"right",right:t,desc:r[a],parentId:e._id})})),t.children.push(e)}})),t})),t},adminWebTreeData:function(){var e=[];return this.adminWebs.length>0&&(e=Object(g["a"])(this.adminWebs,!0)),e}},data:function(){return{model:{},apiRights:[],adminWebs:[],defaultProps:{children:"children",label:"label"},methodType:{POST:"success",PUT:"warning",DELETE:"danger"},defaultAdminWebCheckedKeys:[],defaultApiRightCheckedKeys:[],rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]}}},methods:{save:function(){var e=this;return Object(b["a"])(Object(m["a"])().mark((function t(){return Object(m["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs["RoleForm"].validate(function(){var t=Object(b["a"])(Object(m["a"])().mark((function t(r){return Object(m["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=12;break}if(!e.id){t.next=6;break}return t.next=4,e.$http.put("rest/roles/".concat(e.id),e.model);case 4:t.next=8;break;case 6:return t.next=8,e.$http.post("rest/roles",e.model);case 8:e.$router.push("/roles/list"),e.$message({type:"success",message:"保存成功"}),t.next=14;break;case 12:return e.$message({type:"error",message:"表单信息不完整"}),t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},fetch:function(){var e=this;return Object(b["a"])(Object(m["a"])().mark((function t(){var r;return Object(m["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("rest/roles/".concat(e.id));case 2:r=t.sent,e.model=r.data;case 4:case"end":return t.stop()}}),t)})))()},fetchApiRights:function(){var e=this;return Object(b["a"])(Object(m["a"])().mark((function t(){var r;return Object(m["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("rest/api_rights");case 2:r=t.sent,e.apiRights=r.data.items;case 4:case"end":return t.stop()}}),t)})))()},fetchAdminWebs:function(){var e=this;return Object(b["a"])(Object(m["a"])().mark((function t(){var r;return Object(m["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("rest/admin_webs");case 2:r=t.sent,e.adminWebs=r.data.items;case 4:case"end":return t.stop()}}),t)})))()},clickWebTree:function(e,t){var r=t.checkedNodes;this.model.adminWebs=p(this.checkTree(r,"web"))},clickApiTree:function(e,t){var r=t.checkedNodes;this.model.apiRights=p(this.checkTree(r,"url"))},checkTree:function(e,t){var r=e.filter((function(e){return"right"===e.type})),a={};r.forEach((function(e){a[e.parentId]?a[e.parentId].push(e.right):a[e.parentId]=[e.right]}));for(var n=[],i=0,s=Object.entries(a);i<s.length;i++){var c=d(s[i],2),o=c[0],l=c[1],u={rights:l};u[t]=o,n.push(u)}return n},getDefaultTreeCheckedKeys:function(e,t){var r="web"===t?this.$refs.webTree:this.$refs.apiTree;return e.reduce((function(e,a){var n=r.getNode(a[t]);return n&&a.rights.forEach((function(t){n.data.children.forEach((function(r){t===r.right&&e.push(r.id)}))})),e}),new Array)},getDefaultAdminWebCheckedKeys:function(){return this.id&&this.model.adminWebs?this.getDefaultTreeCheckedKeys(this.model.adminWebs,"web"):[]},getDefaultApiRightCheckedKeys:function(){return this.id&&this.model.adminWebs?this.getDefaultTreeCheckedKeys(this.model.apiRights,"url"):[]}},created:function(){this.id&&this.fetch(),this.fetchApiRights(),this.fetchAdminWebs()},mounted:function(){var e=this;this.id&&setTimeout((function(){e.defaultAdminWebCheckedKeys=p(e.getDefaultAdminWebCheckedKeys()),e.defaultApiRightCheckedKeys=p(e.getDefaultApiRightCheckedKeys())}),500)}},v=y,k=r("2877"),w=Object(k["a"])(v,a,n,!1,null,null,null);t["default"]=w.exports}}]);
//# sourceMappingURL=Role.68943b7c.js.map